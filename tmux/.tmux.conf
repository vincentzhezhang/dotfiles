###############################################################################
#                                                                             #
#                  ████████╗███╗   ███╗██╗   ██╗██╗  ██╗                      #
#                  ╚══██╔══╝████╗ ████║██║   ██║╚██╗██╔╝                      #
#                     ██║   ██╔████╔██║██║   ██║ ╚███╔╝                       #
#                     ██║   ██║╚██╔╝██║██║   ██║ ██╔██╗                       #
#                     ██║   ██║ ╚═╝ ██║╚██████╔╝██╔╝ ██╗                      #
#                     ╚═╝   ╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═╝                      #
###############################################################################

# TODO
# - add activity/bell ignore list
# - add key binding for switch to next/prev bell/activity marker
#
#

#
# unbind everything to reload config properly
#
# unbind -a

#
# appearance settings
#

set -g allow-rename off
setw -g automatic-rename off

# status bar settings
set -g status-attr default
set -g status-bg colour235 #base02
set -g status-fg colour136 #yellow
set -g status-interval 60
set -g status-justify centre
set -g status-left '#[fg=white,dim,bg=default]#(whoami)@#S#[default] '
set -g status-left-length 90
set -g status-right '#[fg=white,dim,bg=default]#(cut -d" " -f1-3 /proc/loadavg) | #(bash ~/.uptime)#[default]'
set -g status-right-length 60

# window title settings
setw -g window-status-fg colour244 #base0
setw -g window-status-bg default
setw -g window-status-current-fg black
setw -g window-status-current-bg green

# message text
set -g message-bg colour235 #base02
set -g message-fg colour166 #orange

# pane border
set -g pane-border-fg colour235 #base02
set -g pane-active-border-fg colour240 #base01

# pane number display
set -g display-panes-active-colour colour33 #blue
set -g display-panes-colour colour166 #orange

# clock mode
setw -g clock-mode-colour green #green

#
# behaviour settings
#

# Prefix tweak
# TODO will need to choose another prefix as I am going to use 60% keyboard
unbind C-b
set -g prefix M-Escape
bind M-Escape send-prefix
bind C-a send-prefix

# unbind unused keys
unbind C-o # rotate the panes in the current window forwards

# reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded..."

# Enable mouse mode
set -g mouse on

# Custom bindings
bind K send-keys -R \; clear-history

# replace split key bindings and make them start with current path
bind -n M-\ split-window -h -c "#{pane_current_path}"
bind -n M-- split-window -v -c "#{pane_current_path}"
bind -n M-n new-window -c "#{pane_current_path}"
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9
bind { swap-window -t -1
bind } swap-window -t +1

# renumber window for easier switching
set -g renumber-windows on

# Use vim keybindings in copy mode
setw -g mode-keys vi
set -g status-keys vi

# Setup 'v' to begin selection as in Vim
bind -T copy-mode-vi C-WheelUpPane send -X halfpage-up
bind -T copy-mode-vi C-WheelDownPane send -X halfpage-down
bind -T copy-mode-vi 'v' send -X begin-selection
bind -T copy-mode-vi 'r' send -X rectangle-toggle
bind -T copy-mode-vi 'y' send -X copy-pipe 'xclip -in -selection clipboard'
bind p paste-buffer

# 0 is too far away
set -g base-index 1
set -g pane-base-index 1

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind -n M-h if-shell "$is_vim" "send-keys M-h" "select-pane -L"
bind -n M-j if-shell "$is_vim" "send-keys M-j" "select-pane -D"
bind -n M-k if-shell "$is_vim" "send-keys M-k" "select-pane -U"
bind -n M-l if-shell "$is_vim" "send-keys M-l" "select-pane -R"
bind -n M-, if-shell "$is_vim" "send-keys M-," "select-pane -l"

# resize pane quickly, note the number difference to adapt to the screen ratio and character dimension
bind -n C-h resize-pane -L 10
bind -n C-j resize-pane -D 5
bind -n C-k resize-pane -U 5
bind -n C-l resize-pane -R 10
bind -n M-z resize-pane -Z

# move pane around
bind h swap-pane -s {left-of}
bind j swap-pane -s {down-of}
bind k swap-pane -s {up-of}
bind l swap-pane -s {right-of}

# toggle pane synchronization
bind -n M-s set synchronize-panes

# colors
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",tmux-256color:Tc"
# FIXME temporary workaround for mouse select multiline text results junk text in other buffers
set -s set-clipboard off

# copy mode color
setw -g mode-fg black
setw -g mode-bg green

# basic settings
setw -g xterm-keys on # for vim
setw -g mode-keys vi # vi key
setw -g monitor-activity on

# scrollback buffer size increase
set -g history-limit 99999

# Allows for faster key repetition
set -g escape-time 10

#
# WORKAROUNDS
#

# easier ` input in 60% layout
bind -n M-q send-keys `
