#! /usr/bin/env bash

#
# Misc add-ons
#
# uncategorized addons go here

if hash brew > /dev/null 2>&1; then
  # generated by brew shellenv, hardcoded here for speedup
  export HOMEBREW_PREFIX="/home/linuxbrew/.linuxbrew"
  export HOMEBREW_CELLAR="/home/linuxbrew/.linuxbrew/Cellar"
  export HOMEBREW_REPOSITORY="/home/linuxbrew/.linuxbrew"
  export MANPATH="/home/linuxbrew/.linuxbrew/share/man:$MANPATH"
  export INFOPATH="/home/linuxbrew/.linuxbrew/share/info:$INFOPATH"

  for comp_file in "$HOMEBREW_PREFIX"/etc/bash_completion.d/*; do
    source "$comp_file"
  done
fi

if hash fzf > /dev/null 2>&1; then
  #
  # fzf tweaks
  #
  read -r -d '' FZF_DEFAULT_COMMAND <<BASH
    ($GIT_DEFAULT_LS_COMMAND ||
     find . -path "*/\.*" -prune -o -type f -print -o -type l -print |
        sed s/^..//) 2> /dev/null
  BASH
  export FZF_DEFAULT_COMMAND
  
  # let __fzf_cd__ ignore node_modules and static directories
  read -r -d '' FZF_ALT_C_COMMAND <<BASH
  command find -L . -mindepth 1 \
    \\(\
      -path '*/\\.*' -o \
      -path '*/node_modules' -o \
      -path '*/static' -o \
      -fstype 'sysfs' -o \
      -fstype 'devfs' -o \
      -fstype 'devtmpfs' -o \
      -fstype 'proc' \
    \\) -prune -o -type d -print 2> /dev/null | sed 's/^.\///'
BASH
  export FZF_ALT_C_COMMAND
  
  # let __fzf_select__ ignore node_modules and static directories
  # TODO
  # - determine symbolic link type and add trailing slash if applicable
  read -r -d '' FZF_CTRL_T_COMMAND <<BASH
    ($GIT_DEFAULT_LS_COMMAND ||
      command find -L . -mindepth 1 \
        \\(\
            -path '*/\\.*' -o \
            -path '*/node_modules' -o \
            -path '*/static' -o \
            -fstype 'sysfs' -o \
            -fstype 'devfs' -o \
            -fstype 'devtmpfs' -o \
            -fstype 'proc' \
        \\) -prune -o \
        -type f -print -o \
        -type d -printf '%p/\n' -o \
        -type l -print \
    ) 2> /dev/null | sed 's/^.\///'
BASH
  export FZF_CTRL_T_COMMAND
fi
